
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Lab 9 &#8212; Stat 159/259 - Reproducible and Collaborative Data Science 1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Course resources" href="../resources.html" />
    <link rel="prev" title="Lab 8" href="lab8.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="section" id="Lab-9">
<h1>Lab 9<a class="headerlink" href="#Lab-9" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Seaborn:-Statistical-Graphics-in-Python">
<h2>Seaborn: Statistical Graphics in Python<a class="headerlink" href="#Seaborn:-Statistical-Graphics-in-Python" title="Permalink to this headline">¶</a></h2>
<p>So far we’ve learned how to create high quality charts with
<code class="docutils literal"><span class="pre">matplotlib</span></code>. Using the object oriented API we can customize aspects
of our plots and create anything. However, in statistics and data
science there are some types of charts that we always make, and for
those there’s <code class="docutils literal"><span class="pre">seaborn</span></code>.</p>
<p><code class="docutils literal"><span class="pre">seaborn</span></code> is a statistical plotting package built on top of
<code class="docutils literal"><span class="pre">mmatplotlib</span></code> which incorporates <code class="docutils literal"><span class="pre">pandas</span></code> in its design. Like
<code class="docutils literal"><span class="pre">matplotlib</span></code>, <code class="docutils literal"><span class="pre">seaborn</span></code> has an <a class="reference external" href="https://seaborn.pydata.org/examples/index.html">example
gallery</a> with many
great charts and the code to make them. The structure of this lab is
based on the <code class="docutils literal"><span class="pre">`seaborn</span></code> tutorial in the
documentation &lt;<a class="reference external" href="https://seaborn.pydata.org/tutorial.html">https://seaborn.pydata.org/tutorial.html</a>&gt;`__</p>
<p>First, we need data. We’ll be using data from a <a class="reference external" href="https://fivethirtyeight.com/features/how-every-nfl-teams-fans-lean-politically/">Fivethirtyeight article
on the political leanings of NFL
fans</a>
that you can find on
<a class="reference external" href="https://github.com/fivethirtyeight/data/blob/master/nfl-fandom/NFL_fandom_data-surveymonkey.csv">Github</a>.
I’ve renamed the files and put them under the <code class="docutils literal"><span class="pre">data</span></code> directory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
%matplotlib inline
</pre></div>
</div>
</div>
<p>The dataset in <code class="docutils literal"><span class="pre">data/fivethirtyeight-nfl-google.csv</span></code> has aggregated
search interest data for various sports leagues in each market, as well
as Trump’s share of the vote in that market.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span># load the data
nfl_trends = pd.read_csv(&quot;data/fivethirtyeight-nfl-google.csv&quot;, header=1)
nfl_trends.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DMA</th>
      <th>NFL</th>
      <th>NBA</th>
      <th>MLB</th>
      <th>NHL</th>
      <th>NASCAR</th>
      <th>CBB</th>
      <th>CFB</th>
      <th>Trump 2016 Vote%</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abilene-Sweetwater TX</td>
      <td>45%</td>
      <td>21%</td>
      <td>14%</td>
      <td>2%</td>
      <td>4%</td>
      <td>3%</td>
      <td>11%</td>
      <td>79.13%</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albany GA</td>
      <td>32%</td>
      <td>30%</td>
      <td>9%</td>
      <td>1%</td>
      <td>8%</td>
      <td>3%</td>
      <td>17%</td>
      <td>59.12%</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Albany-Schenectady-Troy NY</td>
      <td>40%</td>
      <td>20%</td>
      <td>20%</td>
      <td>8%</td>
      <td>6%</td>
      <td>3%</td>
      <td>4%</td>
      <td>44.11%</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albuquerque-Santa Fe NM</td>
      <td>53%</td>
      <td>21%</td>
      <td>11%</td>
      <td>3%</td>
      <td>3%</td>
      <td>4%</td>
      <td>6%</td>
      <td>39.58%</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alexandria LA</td>
      <td>42%</td>
      <td>28%</td>
      <td>9%</td>
      <td>1%</td>
      <td>5%</td>
      <td>3%</td>
      <td>12%</td>
      <td>69.64%</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span># convert percent strings into floats
numeric_data = (nfl_trends.iloc[:,1:]
                .replace(&quot;%&quot;, &quot;&quot;,regex=True)
                .astype(float))
numeric_data[&quot;DMA&quot;] = nfl_trends[&quot;DMA&quot;]
nfl_trends = numeric_data
</pre></div>
</div>
</div>
<p>As soon as we <code class="docutils literal"><span class="pre">import</span> <span class="pre">seaborn</span></code>, we notice a change.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>plt.hist(nfl_trends[&quot;NFL&quot;], bins=25);
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_6_0.png" src="../_images/labs_lab9_6_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>import seaborn as sns
plt.hist(nfl_trends[&quot;NFL&quot;], bins=25);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_7_1.png" src="../_images/labs_lab9_7_1.png" />
</div>
</div>
<p>Seaborn has several default styles that we can set with a context</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.axes_style(&quot;whitegrid&quot;):
    plt.hist(nfl_trends[&quot;NFL&quot;], bins=25);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_9_1.png" src="../_images/labs_lab9_9_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.axes_style(&quot;ticks&quot;):
    plt.hist(nfl_trends[&quot;NFL&quot;], bins=25);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_10_1.png" src="../_images/labs_lab9_10_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.axes_style(&quot;whitegrid&quot;):
    plt.hist(nfl_trends[&quot;NFL&quot;], bins=25)
    sns.despine()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_11_1.png" src="../_images/labs_lab9_11_1.png" />
</div>
</div>
<p>We can set the style for the whole session as well.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.set_style(&quot;whitegrid&quot;)
</pre></div>
</div>
</div>
<div class="section" id="Plotting-Distributions">
<h3>Plotting Distributions<a class="headerlink" href="#Plotting-Distributions" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Univariate-Distributions">
<h4>Univariate Distributions<a class="headerlink" href="#Univariate-Distributions" title="Permalink to this headline">¶</a></h4>
<p>How does search interest in the NFL vary across markets? To explore this
we want to see the <strong>distribution</strong> of NFL interest in our dataset. In
<code class="docutils literal"><span class="pre">matplotlib</span></code> we can do this with the histogram above. <code class="docutils literal"><span class="pre">seaborn</span></code>
builds off of the histograms in <code class="docutils literal"><span class="pre">matplotlib</span></code> and adds more ways to
visualize the distribution with the <code class="docutils literal"><span class="pre">displot</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.distplot(nfl_trends[&quot;NFL&quot;], bins=25);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_15_1.png" src="../_images/labs_lab9_15_1.png" />
</div>
</div>
<p>We can incorporate <code class="docutils literal"><span class="pre">seaborn</span></code> plotting functions into the object
oriented <code class="docutils literal"><span class="pre">matplotlib</span></code> api.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>fig, ax = plt.subplots(1, 1)
ax = sns.distplot(nfl_trends[&quot;NFL&quot;], bins=25, ax=ax);
ax.set_title(&quot;NFL Interest by Google Searches&quot;)
ax.set_xlabel(&quot;NFL Search Interest&quot;)
ax.set_ylabel(&quot;Count&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f73a93a49b0&gt;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_17_2.png" src="../_images/labs_lab9_17_2.png" />
</div>
</div>
<p><code class="docutils literal"><span class="pre">distplot</span></code> has many options, and I encourage you to <a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.distplot.html">read the
documentation</a>
to see all of them.</p>
<p>For instance, we can just plot the kernel density estimate:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>ax = sns.distplot(nfl_trends[&quot;NFL&quot;], hist=False, kde_kws={&quot;shade&quot;:True});
ax.set_title(&quot;NFL Interest by Google Searches&quot;)
ax.set_xlabel(&quot;NFL Search Interest&quot;)
ax.set_ylabel(&quot;Count&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f73a91e6dd8&gt;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_19_2.png" src="../_images/labs_lab9_19_2.png" />
</div>
</div>
<p>Or plot the kernel density estimate with ticks for each data point:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>ax = sns.distplot(nfl_trends[&quot;NFL&quot;], hist=False,
                  rug=True, kde_kws={&quot;shade&quot;:True});
ax.set_title(&quot;NFL Interest by Google Searches&quot;)
ax.set_xlabel(&quot;NFL Search Interest&quot;)
ax.set_ylabel(&quot;Count&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f73a9383940&gt;
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_21_2.png" src="../_images/labs_lab9_21_2.png" />
</div>
</div>
<p>Notice that we passed in a dictionary called <code class="docutils literal"><span class="pre">kde_kws</span></code>. <code class="docutils literal"><span class="pre">seaborn</span></code>
also has individual functions to plot a kernel density estimate or a rug
plot, which the higher level <code class="docutils literal"><span class="pre">distplot</span></code> function uses. In general, to
pass arguments into these lower level functions, you’ll need to pass in
a dictionary of arguments for those functions.</p>
</div>
<div class="section" id="Bivariate-Distributions">
<h4>Bivariate Distributions<a class="headerlink" href="#Bivariate-Distributions" title="Permalink to this headline">¶</a></h4>
<p>A few weeks ago, Donald Trump picked a fight with NFL players kneeling
during the national anthem to protest police brutality and racial
inequality. Is support for the NFL polarized across party lines? We can
use Google search interest in the NFL to examine this relationship.</p>
<p>The most straightforward way to plot a bivariate distribution is a
simple scatterplot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>plt.scatter(nfl_trends[&quot;NFL&quot;], nfl_trends[&quot;Trump 2016 Vote%&quot;]);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_23_1.png" src="../_images/labs_lab9_23_1.png" />
</div>
</div>
<p>If we want more information on our plot, the <code class="docutils literal"><span class="pre">jointplot</span></code> function in
<code class="docutils literal"><span class="pre">seaborn</span></code> has various ways to visualize a bivariate distribution.
Instead of just taking in a <code class="docutils literal"><span class="pre">numpy</span></code> array or a <code class="docutils literal"><span class="pre">pandas</span></code> Series
object, this function (and most <code class="docutils literal"><span class="pre">seaborn</span></code> functions) take in full
<code class="docutils literal"><span class="pre">pandas</span></code> DataFrames. We can then select what variables to plot in the
function. If you use <code class="docutils literal"><span class="pre">ggplot2</span></code> in R, this style should seem somewhat
familiar.</p>
<p>We can make this scatterplot along with the marginal histograms with
<code class="docutils literal"><span class="pre">jointplot</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.jointplot(data=nfl_trends, x=&quot;NFL&quot;, y=&quot;Trump 2016 Vote%&quot;,
              size=7);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_25_1.png" src="../_images/labs_lab9_25_1.png" />
</div>
</div>
<p>Again, there are all sorts of options we can add.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.jointplot(data=nfl_trends, x=&quot;NFL&quot;, y=&quot;Trump 2016 Vote%&quot;,
              kind=&quot;reg&quot;, size=7);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_27_1.png" src="../_images/labs_lab9_27_1.png" />
</div>
</div>
<p>This plot lets us both visualize the distribution and see a summary
statistic and it’s <span class="math">\(p\)</span>-value (question: what does this
<span class="math">\(p\)</span>-value mean?). With all this information, it looks like there
isn’t much of a relationship between interest in the NFL and support for
Trump in 2016. This is evidence that the NFL is broadly popular among
all Americans, and isn’t polarized.</p>
<p>We can also look at a kernel density estimate of the distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.jointplot(data=nfl_trends, x=&quot;NFL&quot;, y=&quot;Trump 2016 Vote%&quot;,
              kind=&quot;kde&quot;, size=7);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_29_1.png" src="../_images/labs_lab9_29_1.png" />
</div>
</div>
<p>Note that it’s possible to grab the output of the function as a
<code class="docutils literal"><span class="pre">`JointGrid</span></code>
object &lt;<a class="reference external" href="https://seaborn.pydata.org/generated/seaborn.JointGrid.html#seaborn.JointGrid">https://seaborn.pydata.org/generated/seaborn.JointGrid.html#seaborn.JointGrid</a>&gt;`__
and customize it further.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span># make plot
g = sns.jointplot(data=nfl_trends, x=&quot;NFL&quot;, y=&quot;Trump 2016 Vote%&quot;,
              kind=&quot;kde&quot;, size=7);

# change x/y labels on the two axes that hold the marginal distriubtions
g.set_axis_labels(&quot;NFL Interest&quot;, &quot;Trump 2016 Vote Share&quot;)
g.ax_marg_x.set_xlabel(&quot;Marginal Distribution of NFL Interest&quot;)
g.ax_marg_x.xaxis.set_label_position(&quot;top&quot;)

g.ax_marg_y.set_ylabel(&quot;Marginal Distribution of Trump Vote Share&quot;,
                      rotation=270, labelpad=15)
g.ax_marg_y.yaxis.set_label_position(&quot;right&quot;)
plt.tight_layout()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_31_1.png" src="../_images/labs_lab9_31_1.png" />
</div>
</div>
<p>Finally, we can look at the pairwise distributions of all variables
together.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.pairplot(nfl_trends.iloc[:,1:], kind=&quot;reg&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_33_1.png" src="../_images/labs_lab9_33_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Plotting-Categorical-Data">
<h3>Plotting Categorical Data<a class="headerlink" href="#Plotting-Categorical-Data" title="Permalink to this headline">¶</a></h3>
<p>We’ve looked at the distribution of NFL interest across markets. It’s
interesting to see if the distributions for the the other sports leagues
are different. We could make a separate plot for each league, but
<code class="docutils literal"><span class="pre">seaborn</span></code> gives us the tools to put all the distributions on one plot.</p>
<p>To do this, we need to convert our data from a “wide” format where every
league has its own column, to a “long” format where there are only 3
columns. The <code class="docutils literal"><span class="pre">melt</span></code> function in <code class="docutils literal"><span class="pre">pandas</span></code> provides a utility to
convert to a long format.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>nfl_melted = nfl_trends.melt(&quot;DMA&quot;)
nfl_melted.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DMA</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abilene-Sweetwater TX</td>
      <td>NFL</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albany GA</td>
      <td>NFL</td>
      <td>32.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Albany-Schenectady-Troy NY</td>
      <td>NFL</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albuquerque-Santa Fe NM</td>
      <td>NFL</td>
      <td>53.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alexandria LA</td>
      <td>NFL</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>With our data in a long format we can evaluate the difference in the
distributions. A classic plot to compare distributions is a box plot</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span># get rid of trump vote share to only have data on leagues
no_trump = nfl_melted[~nfl_melted[&quot;variable&quot;].str.contains(&quot;Trump&quot;)]
sns.boxplot(data=no_trump, x=&quot;variable&quot;, y=&quot;value&quot;)
plt.xlabel(&quot;League&quot;)
plt.ylabel(&quot;Search Interest&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_37_1.png" src="../_images/labs_lab9_37_1.png" />
</div>
</div>
<p>A more modern plot is a “Violin” plot, which embeds a boxplot in a
kernel density estimate plot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>sns.violinplot(data=no_trump, x=&quot;variable&quot;, y=&quot;value&quot;)
plt.xlabel(&quot;League&quot;)
plt.ylabel(&quot;Search Interest&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_39_1.png" src="../_images/labs_lab9_39_1.png" />
</div>
</div>
<p>We can also compare the distribution for each league in states where
Trump did and did not win a majority.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>nfl_trends[&quot;Majority Trump&quot;] = nfl_trends[&quot;Trump 2016 Vote%&quot;] &gt; 50
nfl_melted = nfl_trends.melt([&quot;DMA&quot;, &quot;Majority Trump&quot;])
nfl_melted.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DMA</th>
      <th>Majority Trump</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abilene-Sweetwater TX</td>
      <td>True</td>
      <td>NFL</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albany GA</td>
      <td>True</td>
      <td>NFL</td>
      <td>32.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Albany-Schenectady-Troy NY</td>
      <td>False</td>
      <td>NFL</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albuquerque-Santa Fe NM</td>
      <td>False</td>
      <td>NFL</td>
      <td>53.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alexandria LA</td>
      <td>True</td>
      <td>NFL</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>no_trump = nfl_melted[~nfl_melted[&quot;variable&quot;].str.contains(&quot;Trump&quot;)]
sns.violinplot(data=no_trump, x=&quot;variable&quot;, y=&quot;value&quot;,
               hue=&quot;Majority Trump&quot;, split=True)
plt.xlabel(&quot;League&quot;)
plt.ylabel(&quot;Search Interest&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_42_1.png" src="../_images/labs_lab9_42_1.png" />
</div>
</div>
<p>There are many more types of categorical plots you can make. A great
resource is the <a class="reference external" href="https://seaborn.pydata.org/tutorial/categorical.html">tutorial in the
documentation</a>.</p>
<p>For exercises we’ll be using a different dataset, also from the same
article. <code class="docutils literal"><span class="pre">data/fiverthirtyeight-nfl-fan.csv</span></code> contains information on
the number of fans who identify as as Republicans, Democrats, or
Independents by race. We’ll just look at the aggregate numbers which
show the percentage of Republicans, Democrats, and Independents, as well
as the percentage of responders who identify as white and non-white.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>all_fans = pd.read_csv(&quot;data/fivethirtyeight-nfl-fan.csv&quot;, header=1)
# only keep aggregates
small_fans = all_fans[[&quot;Team&quot;,&quot;GOP%&quot;, &quot;Dem%&quot;, &quot;Ind%&quot;, &quot;White%&quot;, &quot;Nonwhite%&quot;]]

# convert percent strings into floats
numeric_data = (small_fans.iloc[:,1:]
                .replace(&quot;%&quot;, &quot;&quot;,regex=True)
                .astype(float))
numeric_data[&quot;Team&quot;] = small_fans[&quot;Team&quot;]
small_fans = numeric_data
small_fans.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>GOP%</th>
      <th>Dem%</th>
      <th>Ind%</th>
      <th>White%</th>
      <th>Nonwhite%</th>
      <th>Team</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>26.0</td>
      <td>26.0</td>
      <td>48.0</td>
      <td>68.0</td>
      <td>32.0</td>
      <td>Arizona Cardinals</td>
    </tr>
    <tr>
      <th>1</th>
      <td>29.0</td>
      <td>31.0</td>
      <td>40.0</td>
      <td>57.0</td>
      <td>43.0</td>
      <td>Atlanta Falcons</td>
    </tr>
    <tr>
      <th>2</th>
      <td>19.0</td>
      <td>37.0</td>
      <td>43.0</td>
      <td>68.0</td>
      <td>32.0</td>
      <td>Baltimore Ravens</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26.0</td>
      <td>24.0</td>
      <td>50.0</td>
      <td>67.0</td>
      <td>33.0</td>
      <td>Buffalo Bills</td>
    </tr>
    <tr>
      <th>4</th>
      <td>30.0</td>
      <td>31.0</td>
      <td>39.0</td>
      <td>70.0</td>
      <td>30.0</td>
      <td>Carolina Panthers</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Exercise: Create box plots which show the distribution of GOP, Dem, and
Indep support across the teams. The box plots should all be on the same
figure</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
<p>Exercise: Make the same plot with each distribution split between teams
where greater than 75% of respondents identify as white and where less
than 75% of respondents identify as white</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
</div>
<div class="section" id="Fitting-and-plotting-functions">
<h3>Fitting and plotting functions<a class="headerlink" href="#Fitting-and-plotting-functions" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">seaborn</span></code> also provides functions to plot and fit relationships which
generalize scatter plots in <code class="docutils literal"><span class="pre">matplotlib</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">lmplot</span></code> function will plot a scatter plot of the data and fit and
visualize a linear model on top of it. Let’s look again at the
relationship between NFL interest and Trump support.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>g = sns.lmplot(data=nfl_trends, x=&quot;NFL&quot;, y=&quot;Trump 2016 Vote%&quot;)
g.set_axis_labels(&quot;NFL Interest&quot;, &quot;Trump 2016 Vote Share&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_50_1.png" src="../_images/labs_lab9_50_1.png" />
</div>
</div>
<p>And for NASCAR</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>g = sns.lmplot(data=nfl_trends, x=&quot;NASCAR&quot;, y=&quot;Trump 2016 Vote%&quot;)
g.set_axis_labels(&quot;NASCAR Interest&quot;, &quot;Trump 2016 Vote Share&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_52_1.png" src="../_images/labs_lab9_52_1.png" />
</div>
</div>
<p>We can also hit higher order models and non-parametric models such as
LOWESS</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>g = sns.lmplot(data=nfl_trends, x=&quot;NASCAR&quot;, y=&quot;Trump 2016 Vote%&quot;,
              order=3)
g.set_axis_labels(&quot;NASCAR Interest&quot;, &quot;Trump 2016 Vote Share&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_54_1.png" src="../_images/labs_lab9_54_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>g = sns.lmplot(data=nfl_trends, x=&quot;NASCAR&quot;, y=&quot;Trump 2016 Vote%&quot;,
              lowess=True, line_kws={&#39;linestyle&#39;:&quot;--&quot;})
g.set_axis_labels(&quot;NASCAR Interest&quot;, &quot;Trump 2016 Vote Share&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_55_1.png" src="../_images/labs_lab9_55_1.png" />
</div>
</div>
<p>With <code class="docutils literal"><span class="pre">residplot</span></code> we can plot the residuals and evaluate the fit.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>ax = sns.residplot(data=nfl_trends, x=&quot;NASCAR&quot;, y=&quot;Trump 2016 Vote%&quot;,
              order=3)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_57_1.png" src="../_images/labs_lab9_57_1.png" />
</div>
</div>
<p>We can also fit a logistic regression. Note that it’s more computational
expensive than fitting a linear regression.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>g = sns.lmplot(data=nfl_trends, x=&quot;NASCAR&quot;, y=&quot;Majority Trump&quot;,
              logistic=True, line_kws={&#39;linestyle&#39;:&quot;--&quot;}, y_jitter=0.03)
g.set_axis_labels(&quot;NASCAR Interest&quot;, &quot;Majority Trump&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_59_1.png" src="../_images/labs_lab9_59_1.png" />
</div>
</div>
<p>So we see that there’s evidence that NASCAR interest is related to Trump
support (why does that make sense?), and there isn’t evidence that NFL
interest is related to Trump support. We can look at all the leagues
simultaneously.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>nfl_melted = nfl_trends.melt([&quot;DMA&quot;, &quot;Majority Trump&quot;, &quot;Trump 2016 Vote%&quot;])
with sns.plotting_context(&quot;poster&quot;):
    g = sns.lmplot(data=nfl_melted, x=&quot;value&quot;, y=&quot;Trump 2016 Vote%&quot;,
                  col=&quot;variable&quot;, col_wrap=3, scatter_kws={&quot;alpha&quot;:.5},
                  sharex=False)
    g.set_axis_labels(&quot;Interest&quot;, &quot;Trump 2016 Vote Share&quot;)
    g.set_titles(&quot;{col_name}&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_61_1.png" src="../_images/labs_lab9_61_1.png" />
</div>
</div>
<p>Exercise: Using the NFL fan identification data, create a scatter plot
of percent identifying as Republicans vs percent identifying as
non-white</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
<p>Exercise: Now create the same plot where the dependent variable changes
from GOP to Dem to Independent</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
</div>
<div class="section" id="Faceting-arbitrary-plots">
<h3>Faceting arbitrary plots<a class="headerlink" href="#Faceting-arbitrary-plots" title="Permalink to this headline">¶</a></h3>
<p>With <code class="docutils literal"><span class="pre">seaborn</span></code> we can created faceted plots out of any plot with the
<code class="docutils literal"><span class="pre">FacetGrid</span></code> object. Many of the objects that the functions we’ve been
using return are of type <code class="docutils literal"><span class="pre">FacetGrid</span></code>. It creates a plot where the
columns and rows are defined as “facets” of the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>nfl_melted.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DMA</th>
      <th>Majority Trump</th>
      <th>Trump 2016 Vote%</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Abilene-Sweetwater TX</td>
      <td>True</td>
      <td>79.13</td>
      <td>NFL</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Albany GA</td>
      <td>True</td>
      <td>59.12</td>
      <td>NFL</td>
      <td>32.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Albany-Schenectady-Troy NY</td>
      <td>False</td>
      <td>44.11</td>
      <td>NFL</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Albuquerque-Santa Fe NM</td>
      <td>False</td>
      <td>39.58</td>
      <td>NFL</td>
      <td>53.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Alexandria LA</td>
      <td>True</td>
      <td>69.64</td>
      <td>NFL</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.plotting_context(&quot;poster&quot;):
    g = sns.FacetGrid(data=nfl_melted, col=&quot;variable&quot;, col_wrap=3)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_69_1.png" src="../_images/labs_lab9_69_1.png" />
</div>
</div>
<p>Now we can create a plot on each facet by mapping the plot function
across each facet.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.plotting_context(&quot;poster&quot;):
    g = sns.FacetGrid(data=nfl_melted, col=&quot;variable&quot;, col_wrap=3)
    g.map(plt.hist, &quot;value&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_71_1.png" src="../_images/labs_lab9_71_1.png" />
</div>
</div>
<p>We can provide any of the arguments that seaborn uses (e.g. <code class="docutils literal"><span class="pre">hue</span></code>) to
the <code class="docutils literal"><span class="pre">FacetGrid</span></code> initialization, and add arguments for the plot when we
map the plotting function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.plotting_context(&quot;poster&quot;):
    g = sns.FacetGrid(data=nfl_melted, col=&quot;variable&quot;, col_wrap=3,
                      hue=&quot;Majority Trump&quot;)
    g.map(sns.distplot, &quot;value&quot;, hist=False, kde_kws={&quot;bw&quot;:.7})
    g.add_legend()
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_73_1.png" src="../_images/labs_lab9_73_1.png" />
</div>
</div>
<p>We can change each plot’s title, the name of the x and y axes, etc.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>with sns.plotting_context(&quot;poster&quot;):
    g = sns.FacetGrid(data=nfl_melted, col=&quot;variable&quot;, col_wrap=3,
                      hue=&quot;Majority Trump&quot;)
    g.map(sns.distplot, &quot;value&quot;, hist=False, kde_kws={&quot;bw&quot;:.7})
    g.add_legend()
    g.set_axis_labels(&quot;Interest&quot;, &quot;Density Estimate&quot;)
    g.set_titles(&quot;{col_name}&quot;)
    g.fig.subplots_adjust(top=0.9)
    plt.suptitle(&quot;Search interest in sports leagues&quot;);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_75_1.png" src="../_images/labs_lab9_75_1.png" />
</div>
</div>
<p>Exercise: Using the NFL fan identification data, create a plot with
kernel density plots of the distribution of GOP, Dem, and Independent
support across teams, separating out teams where greater than 75% of fan
respondents indentified as white. Facet the rows by party and the
columns by greater than 75% white.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Solutions-to-Quiz-3">
<h2>Solutions to Quiz 3<a class="headerlink" href="#Solutions-to-Quiz-3" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Problem-1">
<h3>Problem 1<a class="headerlink" href="#Problem-1" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Part-A-(2-points)">
<h4>Part A (2 points)<a class="headerlink" href="#Part-A-(2-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which centers a matrix, i.e.&nbsp;for a matrix
<span class="math">\(X \in R^{n\times d}\)</span> with columns <span class="math">\(X_1,\ldots, X_d\)</span>, each
column should have mean zero</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def center(X):
    &quot;&quot;&quot;Center a matrix X&quot;&quot;&quot;
    return(X - X.mean(0))
</pre></div>
</div>
</div>
</div>
<div class="section" id="Part-B-(2-points)">
<h4>Part B (2 points)<a class="headerlink" href="#Part-B-(2-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which standardizes a matrix, i.e.&nbsp;for a matrix
<span class="math">\(X \in R^{n\times d}\)</span> with columns <span class="math">\(X_1,\ldots, X_d\)</span>, each
column should have mean zero and variance 1</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def standardize(X):
    &quot;&quot;&quot;Standardize a matrix X&quot;&quot;&quot;
    return((X - X.mean(0)) / X.std(0))
</pre></div>
</div>
</div>
</div>
<div class="section" id="Part-C-(2-points)">
<h4>Part C (2 points)<a class="headerlink" href="#Part-C-(2-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which normalizes a matrix, i.e.&nbsp;for a matrix <span class="math">\(X\)</span>,
with columns <span class="math">\(X_1,\ldots, X_d\)</span>, define a new matrix
<span class="math">\(\tilde{X}\)</span> such that for each column</p>
<div class="math">
\[\tilde{X}_{i} = \frac{X_{i} - min(X_i)}{max(X_i) - min(X_i)}\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def normalize(X):
    &quot;&quot;&quot;Standardize a matrix X&quot;&quot;&quot;
    return((X - X.min(0)) / (X.max(0) - X.min(0)))
</pre></div>
</div>
</div>
</div>
<div class="section" id="Part-D-(2-points)">
<h4>Part D (2 points)<a class="headerlink" href="#Part-D-(2-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a functions which takes in a matrix <span class="math">\(X\)</span> and normalizes the
rows so that each row has unit norm, i.e.&nbsp;project the rows onto the unit
sphere</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def project(X):
    &quot;&quot;&quot;Project rows of X onto the unit sphere&quot;&quot;&quot;
    return(X / np.linalg.norm(X, axis=1, keepdims=True))
</pre></div>
</div>
</div>
</div>
<div class="section" id="Part-E-(4-points)">
<h4>Part E (4 points)<a class="headerlink" href="#Part-E-(4-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which takes in a vector <span class="math">\(X\)</span> and plots a histogram
for <span class="math">\(X\)</span>, the centered version of <span class="math">\(X\)</span>, the standardized
version of <span class="math">\(X\)</span> and the normalized version of <span class="math">\(X\)</span>. Be sure to
use one figure and 4 axes. Also create a title for each subplot and one
title for the whole plot. You may find the function
<code class="docutils literal"><span class="pre">plt.tight_layout()</span></code> to be useful here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def plot_transforms(x):
    &quot;&quot;&quot;Plot histogram of x and transformations&quot;&quot;&quot;
    # get figure and axes
    fig, axes = plt.subplots(2, 2, figsize=(8,9/2))

    # first histogram
    axes[0,0].hist(x, bins=50)
    axes[0,0].set_title(&quot;Un-transformed&quot;)

    # centered
    axes[0,1].hist(center(x), bins=50)
    axes[0,1].set_title(&quot;Centered&quot;)

    # standardized
    axes[1,0].hist(standardize(x), bins=50)
    axes[1,0].set_title(&quot;Standardized&quot;)

    # normalized
    axes[1,1].hist(normalize(x), bins=50)
    axes[1,1].set_title(&quot;Normalized&quot;)

    # sup title
    fig.suptitle(&quot;Histograms of transformed x&quot;, y=1.05)

    plt.tight_layout()
    return(fig, axes)

np.random.seed(1234)
x = np.random.gumbel(4, 5, 1000)
plot_transforms(x);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_87_1.png" src="../_images/labs_lab9_87_1.png" />
</div>
</div>
<p>Exercise: Make this same plot using <code class="docutils literal"><span class="pre">FacetGrid</span></code> in <code class="docutils literal"><span class="pre">seaborn</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>x = np.random.gumbel(4, 5, 1000)
x = pd.DataFrame(x)
x.columns = [&quot;Un-transformed&quot;]
x[&quot;Centered&quot;] = center(x[&quot;Un-transformed&quot;])
x[&quot;Standardized&quot;] = standardize(x[&quot;Un-transformed&quot;])
x[&quot;Normalized&quot;] = normalize(x[&quot;Un-transformed&quot;])
x[&quot;id&quot;] = x.index
x.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[48]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Un-transformed</th>
      <th>Centered</th>
      <th>Standardized</th>
      <th>Normalized</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7.340602</td>
      <td>-0.060823</td>
      <td>-0.009010</td>
      <td>0.244636</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.906788</td>
      <td>-8.308213</td>
      <td>-1.230694</td>
      <td>0.083268</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5.612750</td>
      <td>-1.788675</td>
      <td>-0.264956</td>
      <td>0.210829</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.470330</td>
      <td>-5.931094</td>
      <td>-0.878572</td>
      <td>0.129779</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.207334</td>
      <td>-7.194091</td>
      <td>-1.065660</td>
      <td>0.105067</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
</div>
<div class="section" id="Part-F-(3-points)">
<h4>Part F (3 points)<a class="headerlink" href="#Part-F-(3-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which takes in a 2 dimensional matrix X, makes a
scatter plot of the rows, and makes a scatter plot of the rows projected
onto the unit circle. Be sure to only create one figure and 2 subplots.
Include a title for each subplot and a title for the whole plot. Again,
the function <code class="docutils literal"><span class="pre">plt.tight_layout()</span></code> may be useful here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def plot_project(X):
    &quot;&quot;&quot;Plot a scatter plot of X and of the rows projected on to the circle&quot;&quot;&quot;

    ### BEGIN SOLUTION
    # get figure and axes
    fig, axes = plt.subplots(1, 2, figsize=(8,9/2))

    # regular
    axes[0].scatter(X[:, 0], X[:, 1])
    axes[0].set_title(&quot;Un-transformed&quot;)

    # centered
    X_proj = project(X)
    axes[1].scatter(X_proj[:, 0], X_proj[:, 1])
    axes[1].set_title(&quot;Projected&quot;)


    # sup title
    fig.suptitle(&quot;Scatterplots of X&quot;, y=1.05)

    plt.tight_layout()
    return(fig, axes)

    ### END SOLUTION

np.random.seed(1234)
x1 = np.random.exponential(4, 1000)
x2 = np.random.chisquare(2, 1000)
X = np.vstack([x1, x2]).T
plot_project(X);
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_92_1.png" src="../_images/labs_lab9_92_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Problem-2">
<h3>Problem 2<a class="headerlink" href="#Problem-2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Part-A-(5-points)">
<h4>Part A (5 points)<a class="headerlink" href="#Part-A-(5-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which takes in an <span class="math">\(n \times d\)</span> matrix of features
<span class="math">\(X\)</span>, and an <span class="math">\(n\)</span> dimensional vector of outputs <span class="math">\(y\)</span>, and
returns the OLS estimate:</p>
<div class="math">
\[\hat{\beta} = (X^TX)^{-1}X^Ty\]</div>
<p>Note: Use pure numpy, not a package that computes the OLS for you. The
goal here is to perform the linear algebra operations <strong>in numpy</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def compute_ols(X, y):
    &quot;&quot;&quot;Computes the OLS estimate of y regressed on X&quot;&quot;&quot;
    return(np.linalg.inv( X.T @ X) @ X.T @ y)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Part-B-(5-points)">
<h4>Part B (5 points)<a class="headerlink" href="#Part-B-(5-points)" title="Permalink to this headline">¶</a></h4>
<p>Write a function which takes in an <span class="math">\(n \times 2\)</span> matrix of features
<span class="math">\(X\)</span> (a column of 1s and the univariate covariate), and an
<span class="math">\(n\)</span> dimensional vector of outputs <span class="math">\(y\)</span>, and makes a scatter
plot of y on x and plots the line resulting from the least squares
estimate. Make sure to label your axes and create a title.</p>
<p>Note: Passing in a matrix with a column of 1s means that the ols
estimate will have two parts: the intercept, and the slope. Make sure to
incorporate <strong>both</strong> of these when plotting the least squares regression
line</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>def plot_ols(X, y):
    &quot;&quot;&quot;Make a scatter plot of y on X&quot;&quot;&quot;

    ### BEGIN SOLUTION
    # compute ols
    ols = compute_ols(X, y)

    # start the scatter plot
    plt.scatter(X[:, 1], y)

    # add the regression line
    xmin = X[:, 1].min()
    xmax = X[:, 1].max()

    y_hat_min = ols[0] + ols[1] * xmin
    y_hat_max = ols[0] + ols[1] * xmax

    plt.plot([xmin, xmax], [y_hat_min, y_hat_max])

    plt.xlabel(&quot;x&quot;)
    plt.ylabel(&quot;y&quot;)
    plt.title(&quot;y Regressed on x&quot;)
    ### END SOLUTION

# simulate heterskedastic data
np.random.seed(159)
n = 100
X = np.vstack([np.ones(n), np.random.randn(n)]).T
beta = np.random.laplace(0, 1, 2)
y = X @ beta + np.random.randn(n) * (X[:, 1] - X.min(0)[1])

# plot
plot_ols(X, y)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/ebenmichael/anaconda3/lib/python3.6/site-packages/matplotlib/font_manager.py:1297: UserWarning: findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans
  (prop.get_family(), self.defaultFamily[fontext]))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/labs_lab9_96_1.png" src="../_images/labs_lab9_96_1.png" />
</div>
</div>
<p>Exercise: Create this plot using <code class="docutils literal"><span class="pre">seaborn</span></code></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3"><div class="highlight"><pre>
<span></span>### Your code here
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Stat 159/259 - Reproducible and Collaborative Data Science</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../lectures/01-git/Git-Tutorial.html">An interactive Git Tutorial: the tool you didn’t know you needed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/02-ipython/Index.html">A quick overview of the Jupyter Notebook and IPython</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/03-reading1-discussion.html">Reading discussion - Developing open source scientific practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/04-reading2-discussion.html">Reading discussion - Scientific Python, IPython, Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/05-class-practice.html">Class practice: strings, lists &amp; numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/06-conda-pip-environments.html">Conda and pip - managing environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/07-reading3-discussion.html">From September 25 reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/07-reading3-discussion.html#Make:-automating-tasks">Make: automating tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/08-ligo-make.html">LIGO, the 2017 Nobel prize in physics, and wrapping up Makefiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/09-intro-numpy/intro-numpy.html">An Introduction to the Scientific Python Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/09-intro-numpy/intro-numpy.html#Motivation:-the-trapezoidal-rule">Motivation: the trapezoidal rule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/09-intro-numpy/intro-numpy.html#NumPy-arrays:-the-right-data-structure-for-scientific-computing">NumPy arrays: the right data structure for scientific computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/09-intro-numpy/intro-numpy.html#High-quality-data-visualization-with-Matplotlib">High quality data visualization with Matplotlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/09-intro-numpy/trapezoid.html">The trapezoidal rule: vectorization and perormance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/10-matplotlib_beyond_basics/10-matplotlib_beyond_basics.html">Matplotlib: Beyond the basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/10-matplotlib_beyond_basics/10-matplotlib_live_plots.html">Matplotlib: Live plots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/10-matplotlib_beyond_basics/image_tutorial.html">Matplotlib image tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/10-matplotlib_beyond_basics/image_tutorial.html#Multichannel-images">Multichannel images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/11-strings/11-strings.html">Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/11-strings/11-nltk.html">NLTK: Natural Language Made Easy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/12-data-intro.html">Data - an introduction to the world of Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/13-data-frames.html">Data Manipulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/14-sphinx.html">An introduction to Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lectures/15-pvalues/index.html">P-values discussion with Prof. Philip B. Stark</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="lab1.html">Lab 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab10.html">Lab 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab2.html">Lab 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab3.html">Lab 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab4.html">Lab 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab5.html">Lab 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab6.html">Lab 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab7.html">Lab 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="lab8.html">Lab 8</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Lab 9</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Course resources</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="lab8.html" title="previous chapter">Lab 8</a></li>
      <li>Next: <a href="../resources.html" title="next chapter">Course resources</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Fernando Perez.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/labs/lab9.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>